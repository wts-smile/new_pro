<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
    <link rel="stylesheet" href="layui/css/layui.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" type="text/css" media="screen and (max-width:992px)" href="css/admin.mobile.css">
    <link rel="stylesheet" href="css/sideBar_style.css">
    <style>
        /*导航*/
        
        * {
            margin: 0;
            padding: 0
        }
        
        a {
            text-decoration: none
        }
        
        .box {
            margin: 10px;
            left: 200px;
            /* position: absolute; */
            position: relative;
        }
        
        .order-class {
            width: 800px;
            font-size: 0
        }
        
        .order-class .bar {
            font-size: 14px;
            font-weight: 700;
            width: 100px;
            text-align: center;
            display: inline-block;
            color: #333;
            padding: 0 10px;
            height: 20px;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            margin: 0 0 0 -1px
        }
        
        .order-class .on {
            color: #f6615b;
            font-size: 14px;
            font-weight: bold
        }
        /*指针*/
        
        .order-class-pointer {
            width: 800px;
            height: 3px;
            background: #c8c8c8;
            margin: 10px 0 0 -1px
        }
        
        .order-class-pointer .pointer {
            width: 121px;
            height: 3px;
            background: #f6615b
        }
        
        .sidebar {
            width: 200px;
        }
        
        .formContainer {
            /* margin-left: 400px; */
        }
    </style>

</head>

<body>

    <div class="sidebar">
        <!-- sidebartop -->
        <div class="sidebar__top">
            <div class="top">
                <h2>用户面板</h2>
                <div class="humburger">
                    <span class="line"></span>
                    <span class="line"></span>
                    <span class="line"></span>
                </div>
            </div>
        </div>
        <!--sidebar navigation -->
        <div class="sidebar__nav">
            <h5>导航菜单</h5>
            <ul class="sidebar__menu">
                <li class="sidebar__menu--item" onclick="toHome()">
                    <span>商场主页</span>
                </li>
                <li class="sidebar__menu--item" style="background-color: #1376ff;" onclick="toOrder()">
                    <span>我的订单</span>
                </li>
                <li class="sidebar__menu--item"  onclick="toCart()">
                    <span>我的购物车</span>
                </li>
                <li class="sidebar__menu--item" onclick="toAddr()">
                    <span>收货地址管理</span>
                </li>
                <li class="sidebar__menu--item" onclick="toDetail()" style="display:none;" >
                    <span>个人资料</span>
                </li>
                <!-- <li class="sidebar__menu--item"> -->
                <li class="sidebar__menu--item" onclick="toPass()">
                    <span>修改密码</span>
                </li>
            </ul>
        </div>
        <!-- sidebar profile -->
        <div class="sidebar__profile ">
            <div class="avatar ">
                <img src="img/sideBar1.jpg " alt=" ">
            </div>
            <div class="content " id="showusr">
                <strong>Hello</strong>
                <p>{{username}}</p>
            </div>
            <div class="arrow ">
                <svg xmlns="http://www.w3.org/2000/svg " viewBox="0 0 492.004 492.004 ">
  <path d="M382.678 226.804L163.73 7.86C158.666 2.792 151.906 0 144.698 0s-13.968 2.792-19.032 7.86l-16.124 16.12c-10.492 10.504-10.492 27.576 0 38.064L293.398 245.9l-184.06 184.06c-5.064 5.068-7.86 11.824-7.86 19.028 0 7.212 2.796 13.968 7.86
                  19.04l16.124 16.116c5.068 5.068 11.824 7.86 19.032 7.86s13.968-2.792 19.032-7.86L382.678 265c5.076-5.084 7.864-11.872 7.848-19.088.016-7.244-2.772-14.028-7.848-19.108z " /></svg>
            </div>
        </div>
    </div>




    <div class="formContainer">
        <div class="box">
            <div class="order-class">
                <a href="#" class="bar on">
                    <span onclick="loadorder(0)">所有订单</span>
                </a>
                <a href="#" class="bar">
                    <span onclick="loadorder(1)">待付款</span>
                </a>
                <a href="#" class="bar">
                    <span onclick="loadorder(2)">已支付</span>
                </a>
                <a href="#" class="bar">
                    <span onclick="loadorder(3)">已取消</span>
                </a>
            </div>
            <!--指针-->
            <div class="order-class-pointer">
                <div class="pointer" id="pointer"></div>
            </div>
        </div>


        <div class="layui-layout layui-layout-admin">
            <!-- 主体 -->
            <div class="layui-body">
                <!-- 主要内容 -->
                <div class="container">
                    <!-- 搜索条件 -->
                    <div class="search-res-mask"></div>
                    <!-- 表格列表 -->
                    <div class="table-list">
                        <table id="olist" class="layui-table layui-list-table" lay-skin="line">
                            <thead>
                                <tr>
                                    <th>订单编号</th>
                                    <th>商品名称</th>
                                    <th>商品数量</th>
                                    <th>成交金额</th>
                                    <th>收货人</th>
                                    <th>交易时间</th>
                                    <th>订单状态</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in list">
                                    <td class="layui-table-first"><span class="layui-table-bd">{{item.id}}</span></td>
                                    <td><span class="layui-table-bd">{{item.name}}</span></td>
                                    <td><span class="layui-table-bd">{{item.cnt}}</span></td>
                                    <td><span class="layui-table-bd price">{{item.price}}</span></td>
                                    <td><span class="layui-table-bd">{{item.uname}}</span></td>
                                    <td><span class="layui-table-bd">{{item.time}}</span></td>
                                    <td><span class="layui-table-bd">{{item.status}}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 分页 -->
                    <div id="table-pages" class="tac"></div>

                </div>


	<script src="js/usernav.js"></script>
    <script language="javascript" type="text/javascript">
        pointer('order-class', 121);

        function pointer(nav, classWid) {
            var orderClass = $('.' + nav).children('a'), //导航dom
                wid = classWid, //下标宽,也就是一条分类的宽
                timeout, //定时器
                Sub; //下标

            //找到on确定下标位置
            $(orderClass).each(function() {
                if ($(this).hasClass('on')) Sub = $(this).index('.bar');
            });

            setPointer(Sub * wid); //初始化

            //设置下标位置
            function setPointer(px) {
                $('#pointer').css('margin-left', px + 'px');
            }
            //获取下标位置
            function getPointer() {
                return parseInt($('#pointer').css('margin-left'));
            }

            //指针滑动,分十次移动
            function subSlide(allDis) {
                var distan = (allDis - getPointer()) / 10;
                var i = 0;

                function scro() {
                    i < 9 ? setPointer(getPointer() + distan) : setPointer(allDis);
                    if (i == 9) return;
                    i++;
                    timeout = setTimeout(scro, 50);
                }
                timeout = setTimeout(scro, 50);
            }
            //绑定事件
            orderClass.on({
                'mouseover': function() {
                    clearTimeout(timeout);
                    var allDis = wid * orderClass.index(this);
                    subSlide(allDis);
                },
                'mouseout': function() {
                    clearTimeout(timeout);
                    var allDis = Sub * wid;
                    subSlide(allDis);
                }
            });

        }
    </script>
    <script type="text/javascript" src="js/vue.min.js"></script>
    <script type="text/javascript" src="layui/layui.js"></script>
    <script>
		const vueNavBottom = new Vue({
            el: '#showusr',
            data:{
                username:"anounymous"
            }
		});
		var app = new Vue({
            el: "#olist",
            data: {
                list:[]/* [{
                    id: 1,
                    name: "草莓",
                    price: 10,
                    num: 1,
                    active: true
                }, {
                    id: 2,
                    name: "巧克力",
                    price: 30,
                    num: 2,
                    active: false
                }, {
                    id: 3,
                    name: "奶油蛋糕",
                    price: 50,
                    num: 3,
                    active: true
                }],*/
            }
        });
		$(document).ready(function(){
			//alert("good");
			if(sessionStorage.getItem("cuser"))
			{
				//var tmpuser = JSON.parse(sessionStorage.getItem("cuser")).name;
				vueNavBottom.username= JSON.parse(sessionStorage.getItem("cuser")).name;
				loadorder(0);
				//alert(tmpuser);
			}
		});
		function loadorder(st)
		{
			while(app.list.pop());
			if(sessionStorage.getItem("cuser"))
			{
				var tmpuser = JSON.parse(sessionStorage.getItem("cuser")).name;
				$.ajax({
            //几个参数需要注意一下
                type: "GET",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "http://localhost:8080/order/list" ,//url
                data: {"username":tmpuser},
                success: function (result) {
					console.log(result);
					for(var i of result)
					{
						if(st === 0 || i.status === st)
						{
							var json = {};
							json["id"]=i.orderId;
							json["name"]=i.product.name;
							json["cnt"]=i.num;
							json["price"]=i.num * i.product.price;
							json["uname"]=i.username;
							json["time"]=i.startTime;
							if(i.status == 1)
							{
								json["status"]="未支付";
							}
							if(i.status == 2)
							{
								json["status"]="已支付";
							}
							if(i.status == 3)
							{
								json["status"]="已取消";
							}
							console.log(json);
							app.list.push(json);
						}
					}
					//Vue.delete();
					},
					error : function() {
                    alert("异常！");
					}
				});
				//alert(tmpuser);
			}
		}
    </script>
</body>

</html>
